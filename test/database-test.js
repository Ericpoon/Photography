var chai = require('chai');
var expect = chai.expect;
var database = require('../models/database');

var _testPhotoData = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAnIAAAJyCAYAAABALi2VAAAACXBIWXMAAAsTAAALEwEAmpwYAAA/iGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDx4bXBNTTpEb2N1bWVudElEPmFkb2JlOmRvY2lkOnBob3Rvc2hvcDozYjViZDQzYS0xZWYzLTExN2EtODA0Mi05OWIzMzg0Y2VmMDg8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpJbnN0YW5jZUlEPnhtcC5paWQ6ZmM1OGI2MDUtMDljOS00NThiLWIzNmMtOWY0OTYzYjJhMDg2PC94bXBNTTpJbnN0YW5jZUlEPgogICAgICAgICA8eG1wTU06T3JpZ2luYWxEb2N1bWVudElEPjNBOTVBMzQ3ODY5NkFGRjE0RkExM0UyQjlCOEEzMTNDPC94bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpIaXN0b3J5PgogICAgICAgICAgICA8cmRmOlNlcT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+c2F2ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDo3MTVmNzU4ZS04OWQzLTRmZDAtYmM1OS01ZjgxOGE2MzljYzA8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDp3aGVuPjIwMTctMDEtMjBUMTY6Mjk6NDArMDg6MDA8L3N0RXZ0OndoZW4+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpzb2Z0d2FyZUFnZW50PkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3IChNYWNpbnRvc2gpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICAgICA8c3RFdnQ6Y2hhbmdlZD4vPC9zdEV2dDpjaGFuZ2VkPgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+Y29udmVydGVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpwYXJhbWV0ZXJzPmZyb20gaW1hZ2UvanBlZyB0byBpbWFnZS9wbmc8L3N0RXZ0OnBhcmFtZXRlcnM+CiAgICAgICAgICAgICAgIDwvcmRmOmxpPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5kZXJpdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpwYXJhbWV0ZXJzPmNvbnZlcnRlZCBmcm9tIGltYWdlL2pwZWcgdG8gaW1hZ2UvcG5nPC9zdEV2dDpwYXJhbWV0ZXJzPgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+c2F2ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDpmYzU4YjYwNS0wOWM5LTQ1OGItYjM2Yy05ZjQ5NjNiMmEwODY8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDp3aGVuPjIwMTctMDEtMjBUMTY6Mjk6NDArMDg6MDA8L3N0RXZ0OndoZW4+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpzb2Z0d2FyZUFnZW50PkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3IChNYWNpbnRvc2gpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICAgICA8c3RFdnQ6Y2hhbmdlZD4vPC9zdEV2dDpjaGFuZ2VkPgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgPC9yZGY6U2VxPgogICAgICAgICA8L3htcE1NOkhpc3Rvcnk+CiAgICAgICAgIDx4bXBNTTpEZXJpdmVkRnJvbSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgIDxzdFJlZjppbnN0YW5jZUlEPnhtcC5paWQ6NzE1Zjc1OGUtODlkMy00ZmQwLWJjNTktNWY4MThhNjM5Y2MwPC9zdFJlZjppbnN0YW5jZUlEPgogICAgICAgICAgICA8c3RSZWY6ZG9jdW1lbnRJRD4zQTk1QTM0Nzg2OTZBRkYxNEZBMTNFMkI5QjhBMzEzQzwvc3RSZWY6ZG9jdW1lbnRJRD4KICAgICAgICAgICAgPHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD4zQTk1QTM0Nzg2OTZBRkYxNEZBMTNFMkI5QjhBMzEzQzwvc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPgogICAgICAgICA8L3htcE1NOkRlcml2ZWRGcm9tPgogICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3BuZzwvZGM6Zm9ybWF0PgogICAgICAgICA8cGhvdG9zaG9wOkNvbG9yTW9kZT4zPC9waG90b3Nob3A6Q29sb3JNb2RlPgogICAgICAgICA8cGhvdG9zaG9wOklDQ1Byb2ZpbGUvPgogICAgICAgICA8eG1wOkNyZWF0ZURhdGU+MjAxNy0wMS0yMFQxNjoxNTozNiswODowMDwveG1wOkNyZWF0ZURhdGU+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDE3LTAxLTIwVDE2OjI5OjQwKzA4OjAwPC94bXA6TW9kaWZ5RGF0ZT4KICAgICAgICAgPHhtcDpNZXRhZGF0YURhdGU+MjAxNy0wMS0yMFQxNjoyOTo0MCswODowMDwveG1wOk1ldGFkYXRhRGF0ZT4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoTWFjaW50b3NoKTwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8dGlmZjpJbWFnZVdpZHRoPjYyNjwvdGlmZjpJbWFnZVdpZHRoPgogICAgICAgICA8dGlmZjpJbWFnZUxlbmd0aD42MjY8L3RpZmY6SW1hZ2VMZW5ndGg+CiAgICAgICAgIDx0aWZmOkJpdHNQZXJTYW1wbGU+CiAgICAgICAgICAgIDxyZGY6U2VxPgogICAgICAgICAgICAgICA8cmRmOmxpPjg8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaT44PC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGk+ODwvcmRmOmxpPgogICAgICAgICAgICA8L3JkZjpTZXE+CiAgICAgICAgIDwvdGlmZjpCaXRzUGVyU2FtcGxlPgogICAgICAgICA8dGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPjI8L3RpZmY6UGhvdG9tZXRyaWNJbnRlcnByZXRhdGlvbj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgICAgPHRpZmY6U2FtcGxlc1BlclBpeGVsPjM8L3RpZmY6U2FtcGxlc1BlclBpeGVsPgogICAgICAgICA8dGlmZjpYUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOllSZXNvbHV0aW9uPjcyMDAwMC8xMDAwMDwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICAgICAgICAgPGV4aWY6RXhpZlZlcnNpb24+MDIyMTwvZXhpZjpFeGlmVmVyc2lvbj4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT42NTUzNTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+NjI2PC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjYyNjwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAg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';


// one photo in one gallery
function basicTest() {
    describe('database tests on gallery and photo operations: one photo in one gallery\n', function () {

        var _gname = Math.random();
        var _pid = null;

        var _photoDoc = null;
        var _galleryDoc = null;

        var _initialNumberOfGalleries = null;
        var _duplicatedName = 'DUPLICATED' + Math.random();

        it('should get number of galleries without error', function (done) {
            database.getNumberOfGalleries(function (err, number) {
                if (err) done(err);
                else {
                    done();
                    _initialNumberOfGalleries = number;
                }
            });
        });

        it('the gallery should not exist', function (done) {
            database.isGalleryExisted(_gname, function (err) {
                done(err);
            }, function () {
                done('Gallery exists.');
            }, function () {
                done();
            });
        });

        it('should create new gallery without error', function (done) {
            database.createGallery({
                'name': _gname,
                'description': 'this is a gallery for testing.'
            }, function (err, doc) {
                if (err) done(err);
                else {
                    done();
                    _galleryDoc = doc;
                }
            });
        });

        it('error should occur when creating a gallery with duplicate name', function (done) {
            database.createGallery({'name': _gname, 'description': 'this is a gallery for testing.'}, function (err) {
                if (err) done();
                else done('No error when creating a gallery with duplicate name.');
            });
        });

        it('the gallery should exist', function (done) {
            database.isGalleryExisted(_gname, function (err) {
                done(err);
            }, function () {
                done();
            }, function () {
                done('Gallery not exists.');
            });
        });

        it('should get gallery document without error', function (done) {
            database.getGalleryByName(_gname, function (err, doc) {
                if (err) done(err);
                else if (doc.name != _gname) done('Gallery name does not match.');
                else done();
            });
        });

        it('number of galleries now should be incremented by 1', function (done) {
            database.getNumberOfGalleries(function (err, number) {
                if (err) done(err);
                else if (number - _initialNumberOfGalleries != 1) done('Number of galleries is not correct.');
                else done();
            });
        });

        it('should be an empty gallery', function (done) {
            database.isGalleryEmpty(_gname, function (err) {
                done(err);
            }, function () {
                done();
            }, function () {
                done('Gallery not empty.');
            });
        });

        it('should add new photo without error', function (done) {
            var newPhotoDoc = {
                'title': Math.random(),
                'description': 'Test photo.',
                'gallery': _gname,
                'photoData': _testPhotoData
            };
            database.addNewPhoto(newPhotoDoc, function (err, newPhoto) {
                if (err) done(err);
                else {
                    done();
                    _pid = newPhoto._id;
                    _photoDoc = newPhoto;
                }
            });
        });

        it('the new photo should exist', function (done) {
            database.isPhotoExisted(_pid, function (err) {
                done(err)
            }, function () {
                done()
            }, function () {
                done('Photo not exists.')
            });
        });

        it('should be an non-empty gallery', function (done) {
            database.isGalleryEmpty(_gname, function (err) {
                done(err);
            }, function () {
                done('Gallery is empty.');
            }, function () {
                done();
            });
        });

        it('should have 1 photo in the gallery', function (done) {
            database.getNumberOfPhotos(_gname, function (err, number) {
                if (err) done(err);
                else if (number != 1) done('Number is not 1.');
                else done();
            });
        });

        it('should get photo document without error', function (done) {
            database.getPhotoById(_pid, function (err, doc) {
                if (err) done(err);
                else if (!doc._id.equals(_pid)) done('Photo id does not match.');
                else done();
            });
        });

        it('the new photo should be in the test gallery', function (done) {
            database.getGalleryOfPhoto(_pid, function (err, n) {
                if (err) done(err);
                else if (n != _gname) done('The new photo is not in the correct gallery.');
                else done();
            });
        });

        it('the new photo should be the first photo in the gallery', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id != _pid) done('Id does not match.');
                else done();
            })
        });

        it('the new photo should be the last photo in the gallery', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id != _pid) done('Id does not match.');
                else done();
            })
        });

        it('the new photo should have index 0', function (done) {
            database.getPhotoIndex(_pid, function (err, idx) {
                if (err) done(err);
                else if (idx != 0) done('Index is not 0.');
                else done();
            })
        });

        it('the new photo should have integrated original photo data', function (done) {
            database.getPhotoDataById(_pid, database.PHOTO_QUALITY.ORIGINAL, function (err, data) {
                if (err) done(err);
                else if (data != _testPhotoData) {
                    done('Original photo data invalid.' + '\n\tretrieved data:\n\t' + data);
                }
                else done();
            })
        });

        it('the next photo id should be null', function (done) {
            database.getNextPhotoId(_pid, function (err, id) {
                if (err) done(err);
                else if (id) done('The id of the next photo is not null.');
                else done();
            })
        });

        it('the previous photo id should be null', function (done) {
            database.getPrevPhotoId(_pid, function (err, id) {
                if (err) done(err);
                else if (id) done('The id of the previous photo is not null.');
                else done();
            })
        });

        it('error should occur when removing an non-empty gallery', function (done) {
            database.removeGalleryByName(_gname, function (err) {
                if (err) done();
                else done('No error when removing non-empty gallery.');
            })
        });

        it('the photo title should be updated without side effect', function (done) {
            var newTitle = 'NEW TITLE';
            database.updatePhotoTitle(_pid, newTitle, function (err) {
                if (err) {
                    done(err);
                    return;
                }
                database.getPhotoById(_pid, function (err, doc) {
                    if (err) {
                        done(err);
                        return;
                    }
                    if (
                        doc._id.equals(_pid) &&
                        doc.title == newTitle &&
                        doc.description == _photoDoc.description &&
                        doc.thumbnail == _photoDoc.thumbnail &&
                        doc.large == _photoDoc.large &&
                        doc.original == _photoDoc.original &&
                        doc.gallery == _photoDoc.gallery &&
                        doc.next == _photoDoc.next &&
                        doc.prev == _photoDoc.prev
                    ) {
                        done();
                        _photoDoc.title = newTitle;
                    }
                    else done('Updated photo is invalid. Side-effect of update may exist.');
                });
            });
        });

        it('the photo description should be updated without side effect', function (done) {
            var newDescription = 'NEW PHOTO DESCRIPTION';
            database.updatePhotoDescription(_pid, newDescription, function (err) {
                if (err) {
                    done(err);
                    return;
                }
                database.getPhotoById(_pid, function (err, doc) {
                    if (err) {
                        done(err);
                        return;
                    }
                    if (
                        doc._id.equals(_pid) &&
                        doc.description == newDescription &&
                        doc.title == _photoDoc.title &&
                        doc.thumbnail == _photoDoc.thumbnail &&
                        doc.large == _photoDoc.large &&
                        doc.original == _photoDoc.original &&
                        doc.gallery == _photoDoc.gallery &&
                        doc.next == _photoDoc.next &&
                        doc.prev == _photoDoc.prev
                    ) {
                        done();
                        _photoDoc.description = newDescription;
                    }
                    else done('Updated photo is invalid. Side-effect of update may exist.');
                });
            });
        });

        it('the gallery name should be updated without side effect', function (done) {
            var newName = _duplicatedName;
            database.updateGalleryName(_gname, newName, function (err) {
                if (err) {
                    done(err);
                    return;
                }
                database.getGalleryByName(newName, function (err, gDoc) {
                    if (err) {
                        done(err);
                        return;
                    }
                    database.getPhotoById(_pid, function (err, pDoc) {
                        if (err) {
                            done(err);
                            return;
                        }
                        if (
                            gDoc.name == newName &&
                            gDoc._id.equals(_galleryDoc._id) &&
                            gDoc.description == _galleryDoc.description &&
                            pDoc.gallery == newName
                        ) {
                            done();
                            _galleryDoc.name = newName;
                            _gname = newName;
                            _photoDoc.gallery = newName;
                        }
                        else {
                            done('Updated gallery is invalid. Side-effect of update may exist.');
                        }
                    });
                });
            });
        });

        it('the gallery description should be updated without side effect', function (done) {
            var newDescription = 'NEW GALLERY DESCRIPTION';
            database.updateGalleryDescription(_gname, newDescription, function (err) {
                if (err) {
                    done(err);
                    return;
                }
                database.getGalleryByName(_gname, function (err, doc) {
                    if (err) {
                        done(err);
                        return;
                    }
                    if (
                        doc.description == newDescription &&
                        doc._id.equals(_galleryDoc._id) &&
                        doc.name == _galleryDoc.name
                    ) {
                        done();
                        _galleryDoc.description = newDescription;
                    }
                    else done('Updated gallery is invalid. Side-effect of update may exist.');
                });
            });
        });

        it('error should occur when creating a new gallery with duplicated name', function (done) {
            database.createGallery({
                'name': _duplicatedName,
                'description': 'This gallery will never be created.'
            }, function (err) {
                if (err) done();
                else done('No error when giving a duplicated name to the gallery.');
            })
        });

        it('should remove the photo without error', function (done) {
            database.removePhotoById(_pid, function (err) {
                if (err) done(err);
                else {
                    done();
                    _photoDoc = null;
                    _pid = null;
                }
            });
        });

        it('the photo should not exist', function (done) {
            database.isPhotoExisted(_pid, function (err) {
                done(err)
            }, function () {
                done('Photo exists.')
            }, function () {
                done()
            });
        });

        it('should be an empty gallery', function (done) {
            database.isGalleryEmpty(_gname, function (err) {
                done(err);
            }, function () {
                done();
            }, function () {
                done('Gallery not empty.');
            });
        });

        it('should have 0 photo in the gallery', function (done) {
            database.getNumberOfPhotos(_gname, function (err, number) {
                if (err) done(err);
                else if (number != 0) done('Number is not 0.');
                else done();
            });
        });

        it('the head of the gallery should be null', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id) done('The id of the first photo is not null.');
                else done();
            })
        });

        it('the tail of the gallery should be null', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id) done('The id of the last photo is not null.');
                else done();
            })
        });

        it('should remove an empty gallery without error', function (done) {
            database.removeGalleryByName(_gname, function (err) {
                if (err) done(err);
                else {
                    done();
                    _galleryDoc = null;
                    _gname = null;
                }
            })
        });

        it('the gallery should not exist', function (done) {
            database.isGalleryExisted(_gname, function (err) {
                done(err);
            }, function () {
                done('Gallery exists.');
            }, function () {
                done();
            });
        });
    });
}

// multiple photos in one gallery
function advancedTest() {
    describe('database tests on gallery and photo operations: multiple photos in one gallery\n', function () {
        var _gname = Math.random();
        var _photoNumber = 30; // for stress test, should be > 2, mocha --timeout 0
        var _photoNumberToRemove = _photoNumber / 3; // for stress test, should be <= _photoNumber - 5
        var _photoSequence = [];
        var _randIndexToRemove = null;

        // test starts
        it('should create a new gallery without error', function (done) {
            database.createGallery({name: _gname}, function (err) {
                if (err) done(err);
                else done();
            });
        });

        it('should add two photos without error', function (done) {
            // title 0 1
            _addNewPhotos(_gname, 2, done);
        });
        it('first photo should be head', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                if (err) {
                    done(err);
                    return;
                }
                database.getPhotoById(id, function (err, doc) {
                    if (err) done(err);
                    else if (doc.title != '0') done('Title does not match.');
                    else done();
                });
            });
        });
        it('second photo should be tail', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                if (err) {
                    done(err);
                    return;
                }
                database.getPhotoById(id, function (err, doc) {
                    if (err) done(err);
                    else if (doc.title != '1') done('Title does not match.');
                    else done();
                });
            });
        });
        it('first photo should be at index 0', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                if (err) {
                    done(err);
                    return;
                }
                database.getPhotoIndex(id, function (err, index) {
                    if (err) {
                        done(err);
                        return;
                    }
                    if (index != 0) done('Index does not match');
                    else done();
                })
            });
        });
        it('should get first photo at index 0', function (done) {
            database.getFirstPhotoId(_gname, function (err, firstId) {
                if (err) {
                    done(err);
                    return;
                }
                database.getPhotoIdAtIndex(_gname, 0, function (err, id) {
                    if (err) {
                        done(err);
                        return;
                    }
                    if (id != firstId) done('Id does not match.');
                    else done();
                });
            });
        });
        it('second photo should be at index 1', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                if (err) {
                    done(err);
                    return;
                }
                database.getPhotoIndex(id, function (err, index) {
                    if (err) {
                        done(err);
                        return;
                    }
                    if (index != 1) done('Index does not match');
                    else done();
                })
            });
        });
        it('should get second photo at index 1', function (done) {
            database.getLastPhotoId(_gname, function (err, lastId) {
                if (err) {
                    done(err);
                    return;
                }
                database.getPhotoIdAtIndex(_gname, 1, function (err, id) {
                    if (err) {
                        done(err);
                        return;
                    }
                    if (id != lastId) done('Id does not match.');
                    else done();
                });
            });
        });
        // linked list test: two elements in the linked list
        it('should remove first one without error', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                if (err) {
                    done(err);
                    return;
                }
                database.removePhotoById(id, function (err) {
                    if (err) done(err);
                    else done();
                });
            });
        });
        it('gallery head and tail should be the second photo', function (done) {
            database.getFirstPhotoId(_gname, function (err, firstId) {
                if (err) {
                    done(err);
                    return;
                }
                database.getLastPhotoId(_gname, function (err, lastId) {
                    if (err) {
                        done(err);
                        return;
                    }
                    if (firstId != lastId) {
                        done('First and last photo does not match. Should be the same: ' + firstId + ', ' + lastId);
                        return;
                    }
                    database.getPhotoById(firstId, function (err, doc) {
                        if (err) done(err);
                        else if (doc.title != '1') done('Photo is not the second photo just added.');
                        else done();
                    });
                });
            })
        });
        it('should add one photo without error', function (done) {
            // first photo in gallery is of title 1, second photo in gallery is of title 0
            _addNewPhotos(_gname, 1, done);
        });
        it('should remove second one without error', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                if (err) {
                    done(err);
                    return;
                }
                database.removePhotoById(id, function (err) {
                    if (err) done(err);
                    else done();
                });
            });
        });
        it('gallery head and tail should be the first photo', function (done) {
            database.getFirstPhotoId(_gname, function (err, firstId) {
                if (err) {
                    done(err);
                    return;
                }
                database.getLastPhotoId(_gname, function (err, lastId) {
                    if (err) {
                        done(err);
                        return;
                    }
                    if (firstId != lastId) {
                        done('First and last photo does not match. Should be the same.');
                        return;
                    }
                    database.getPhotoById(firstId, function (err, doc) {
                        if (err) done(err);
                        else if (doc.title != '1') done('Photo is not the one of title "1".');
                        else done();
                    });
                });
            })
        });
        it('should empty the non-empty gallery without error', function (done) {
            database.emptyGallery(_gname, function (err) {
                if (err) done(err);
                else done();
            });
        });
        it('gallery head and tail should be the second photo', function (done) {
            database.getFirstPhotoId(_gname, function (err, firstId) {
                if (err) {
                    done(err);
                    return;
                }
                database.getLastPhotoId(_gname, function (err, lastId) {
                    if (err) {
                        done(err);
                        return;
                    }
                    if (firstId == null && lastId == null) {
                        done()
                    } else {
                        done('Either (or both) of the head and tail of the gallery is not null.');
                    }
                });
            })
        });

        // stress test on linked list: add and remove
        it('should add tons of photos without error', function (done) {
            _addNewPhotos(_gname, _photoNumber, function (err, sequence) {
                if (err) done(err);
                else {
                    _photoSequence = sequence;
                    done();
                }
            });
        });
        it('linked list should be in correct order after adding tons of photos', function (done) {
            database.getAllPhotosSorted(_gname, function (err, docs) {
                if (err) {
                    done(err);
                    return;
                }
                if (docs.length != _photoNumber) {
                    done('Number of total photos does not match.');
                    return;
                }
                _checkLinkedList(_gname, _photoSequence, done);
            });
        });
        it('linked list should be in correct order after removing the first photo', function (done) {
            var idx = 0;
            database.removePhotoById(_photoSequence[idx]._id, function (err) {
                if (err) {
                    done(err);
                    return;
                }
                _photoSequence[idx].removed = true;
                _checkLinkedList(_gname, _photoSequence, done);
            });
        });
        it('head of gallery should be correct', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                if (err) {
                    done(err);
                    return;
                }
                if (_photoSequence[1]._id != id) {
                    done('Head of gallery is violated');
                } else {
                    done();
                }
            });
        });
        it('linked list should be in correct order after removing the last photo', function (done) {
            var idx = _photoNumber - 1;
            database.removePhotoById(_photoSequence[idx]._id, function (err) {
                if (err) {
                    done(err);
                    return;
                }
                _photoSequence[idx].removed = true;
                _checkLinkedList(_gname, _photoSequence, done);
            });
        });
        it('tail of gallery should be correct', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                if (err) {
                    done(err);
                    return;
                }
                if (_photoSequence[_photoNumber - 2]._id != id) {
                    done('Tail of gallery is violated');
                } else {
                    done();
                }
            });
        });
        it('linked list should be in correct order after removing a random photo', function (done) {
            var rand = null;
            while (true) {
                rand = parseInt(Math.random() * _photoNumber);
                _randIndexToRemove = rand;
                if (!_photoSequence[rand].removed) {
                    console.log('database-test.js - random index to delete: ' + rand);
                    break;
                }
            }
            database.removePhotoById(_photoSequence[rand]._id, function (err) {
                if (err) {
                    done(err);
                    return;
                }
                _photoSequence[rand].removed = true;
                _checkLinkedList(_gname, _photoSequence, done);
            });
        });
        it('linked list should be in correct order after removing the next photo of the random one', function (done) {
            var idx = _randIndexToRemove + 1;
            if (_photoSequence[idx].removed) {
                done(); // never mind, the next of it has already been removed
                return;
            }
            database.removePhotoById(_photoSequence[idx]._id, function (err) {
                if (err) {
                    done(err);
                    return;
                }
                _photoSequence[idx].removed = true;
                _checkLinkedList(_gname, _photoSequence, done);
            });
        });
        it('linked list should be in correct order after removing the previous photo of the random one', function (done) {
            var idx = _randIndexToRemove - 1;
            if (_photoSequence[idx].removed) {
                done(); // never mind, the previous of it has already been removed
                return;
            }
            database.removePhotoById(_photoSequence[idx]._id, function (err) {
                if (err) {
                    done(err);
                    return;
                }
                _photoSequence[idx].removed = true;
                _checkLinkedList(_gname, _photoSequence, done);
            });
        });
        it('linked list should be in correct order after removing tons of photos', function (done) {
            remove(_photoNumberToRemove, 0, done);

            function remove(total, count, onCompletion) {
                if (count < total) {
                    var rand = null;
                    while (true) {
                        rand = parseInt(Math.random() * _photoNumber);
                        _randIndexToRemove = rand;
                        if (!_photoSequence[rand].removed) {
                            break;
                        }
                    }
                    database.removePhotoById(_photoSequence[rand]._id, function (err) {
                        if (err) {
                            onCompletion(err);
                            return;
                        }
                        _photoSequence[rand].removed = true;
                        remove(total, count + 1, onCompletion);
                    });
                } else {
                    _checkLinkedList(_gname, _photoSequence, onCompletion);
                }
            }

        });

        // remove all, ending the test
        it('should empty the non-empty gallery without error', function (done) {
            database.emptyGallery(_gname, function (err) {
                if (err) done(err);
                else done();
            });
        });
        it('should be an empty gallery', function (done) {
            database.isGalleryEmpty(_gname, function (err) {
                done(err);
            }, function () {
                done();
            }, function () {
                done('Gallery not empty.');
            });
        });
        it('should empty the empty gallery without error', function (done) {
            database.emptyGallery(_gname, function (err) {
                if (err) done(err);
                else done();
            });
        });
        it('should remove the gallery that is already empty without error', function (done) {
            database.removeGalleryByName(_gname, function (err) {
                if (err) done(err);
                else {
                    done();
                    _gname = null;
                }
            })
        });
        it('the gallery should not exist', function (done) {
            database.isGalleryExisted(_gname, function (err) {
                done(err);
            }, function () {
                done('Gallery exists.');
            }, function () {
                done();
            });
        });

    });
}

// multiple photos in multiple galleries
function movePhotoTest() {
    describe('database tests, moving photos among galleries: multiple photos in one gallery\n', function () {
        var _gname1 = Math.random();
        var _gname2 = Math.random();
        var _sequence1 = [];
        var _sequence2 = [];
        var _photoNumber = 10;
        it('should create two galleries without error', function (done) {
            database.createGallery({'name': _gname1}, function (err) {
                if (err) done(err);
                else {
                    database.createGallery({'name': _gname2}, function (err) {
                        if (err) done(err);
                        else done();
                    });

                }
            });
        });
        it('should add new photos to gallery 1 without error', function (done) {
            _addNewPhotos(_gname1, _photoNumber, function (err, sequence) {
                if (err) done(err);
                else {
                    _sequence1 = sequence;
                    done();
                }
            });
        });

        it('should move the first photo of gallery 1 to an empty gallery without error', function (done) {
            database.getFirstPhotoId(_gname1, function (err, id) {
                if (err) {
                    done(err);
                    return;
                }

                database.movePhotoToGallery(id, _gname2, function (err) {
                    if (err) {
                        done(err);
                        return;
                    }
                    _sequence1[0].removed = true;
                    _sequence2.push({_id: id, removed: false});
                    done();
                });

            });
        });
        it('gallery 1 should maintain correct linked list (1)', function (done) {
            _checkLinkedList(_gname1, _sequence1, done);
        });
        it('gallery 2 should maintain correct linked list (1)', function (done) {
            _checkLinkedList(_gname2, _sequence2, done);
        });

        it('should move the last photo of gallery 1 to gallery 2 without error', function (done) {
            database.getLastPhotoId(_gname1, function (err, id) {
                if (err) {
                    done(err);
                    return;
                }
                database.movePhotoToGallery(id, _gname2, function (err) {
                    if (err) {
                        done(err);
                        return;
                    }
                    _sequence1[_sequence1.length - 1].removed = true;
                    _sequence2.push({_id: id, removed: false});
                    done();
                });

            });
        });
        it('gallery 1 should maintain correct linked list (2)', function (done) {
            _checkLinkedList(_gname1, _sequence1, done);
        });
        it('gallery 2 should maintain correct linked list (2)', function (done) {
            _checkLinkedList(_gname2, _sequence2, done);
        });

        it('should add new photos to gallery 2 without error', function (done) {
            _addNewPhotos(_gname2, _photoNumber, function (err, sequence) {
                if (err) done(err);
                else {
                    for (var i = 0; i < sequence.length; i++) {
                        _sequence2.push(sequence[i]);
                    }
                    done();
                }
            });
        });

        it('should move the first photo of gallery 1 again to gallery 2 without error', function (done) {
            database.getFirstPhotoId(_gname1, function (err, id) {
                if (err) {
                    done(err);
                    return;
                }

                database.movePhotoToGallery(id, _gname2, function (err) {
                    if (err) {
                        done(err);
                        return;
                    }
                    _sequence1[1].removed = true; // 0 + 1 = 1
                    _sequence2.push({_id: id, removed: false});
                    done();
                });

            });
        });
        it('gallery 1 should maintain correct linked list (3)', function (done) {
            _checkLinkedList(_gname1, _sequence1, done);
        });
        it('gallery 2 should maintain correct linked list (3)', function (done) {
            _checkLinkedList(_gname2, _sequence2, done);
        });

        it('should move the last photo of gallery 1 again to gallery 2 without error', function (done) {
            database.getLastPhotoId(_gname1, function (err, id) {
                if (err) {
                    done(err);
                    return;
                }
                database.movePhotoToGallery(id, _gname2, function (err) {
                    if (err) {
                        done(err);
                        return;
                    }
                    _sequence1[_sequence1.length - 1 - 1].removed = true;
                    _sequence2.push({_id: id, removed: false});
                    done();
                });

            });
        });
        it('gallery 1 should maintain correct linked list (4)', function (done) {
            _checkLinkedList(_gname1, _sequence1, done);
        });
        it('gallery 2 should maintain correct linked list (4)', function (done) {
            _checkLinkedList(_gname2, _sequence2, done);
        });

        it('should move a photo (not head or tail) of gallery 2 to gallery 1 without error', function (done) {
            var index = 4; // neither head nor tail
            database.getPhotoIdAtIndex(_gname2, index, function (err, id) {
                if (err) {
                    done(err);
                    return;
                }

                database.movePhotoToGallery(id, _gname1, function (err) {
                    if (err) {
                        done(err);
                        return;
                    }
                    _sequence2[index].removed = true;
                    _sequence1.push({_id: id, removed: false});
                    done();
                });

            });
        });
        it('gallery 1 should maintain correct linked list (5)', function (done) {
            _checkLinkedList(_gname1, _sequence1, done);
        });
        it('gallery 2 should maintain correct linked list (5)', function (done) {
            _checkLinkedList(_gname2, _sequence2, done);
        });

        // remove all, ending the test
        it('should empty gallery 1 without error', function (done) {
            database.emptyGallery(_gname1, function (err) {
                if (err) done(err);
                else done();
            });
        });
        it('should empty gallery 2 without error', function (done) {
            database.emptyGallery(_gname2, function (err) {
                if (err) done(err);
                else done();
            });
        });
        it('should remove gallery 1 without error', function (done) {
            database.removeGalleryByName(_gname1, function (err) {
                if (err) done(err);
                else {
                    done();
                    _gname = null;
                }
            })
        });
        it('should remove gallery 2 without error', function (done) {
            database.removeGalleryByName(_gname2, function (err) {
                if (err) done(err);
                else {
                    done();
                    _gname = null;
                }
            })
        });
    });
}

// test swapTwoPhotos() method
function swapPhotoTest() {
    describe('database tests, swapping two photos\n', function () {
        var _gname = Math.random();
        it('should create a new gallery without error', function (done) {
            database.createGallery({name: _gname}, function (err) {
                if (err) done(err);
                else done();
            });
        });

        // part 1
        var _firstId = null;
        var _lastId = null;
        it('should add two photos without error', function (done) {
            // title 0 1
            _addNewPhotos(_gname, 2, done);
        });
        it('should swap two photos without error (the only two photos in the gallery)', function (done) {
            database.getFirstPhotoId(_gname, function (err, firstId) {
                if (err) {
                    done(err);
                    return;
                }
                database.getLastPhotoId(_gname, function (err, lastId) {
                    if (err) {
                        done(err);
                        return;
                    }
                    _firstId = firstId;
                    _lastId = lastId;
                    database.swapTwoPhotos(firstId, lastId, function (err) {
                        if (err) done(err);
                        else done();
                    });
                });
            });
        });
        it('two photos should be swapped correctly', function (done) {
            database.getPhotoIdAtIndex(_gname, 0, function (err, id0) {
                if (err) {
                    done(err);
                    return;
                }
                database.getPhotoIdAtIndex(_gname, 1, function (err, id1) {
                    if (err) {
                        done(err);
                        return;
                    }

                    if (id0 == _lastId && id1 == _firstId) {
                        done();
                    } else {
                        done('Result of swapping is not valid:\n\t  actual order: ' +
                            id0 + ', ' + id1 + '\n\t correct order: ' + _lastId + ', ' + _firstId);
                    }
                });
            });
        });
        it('head of gallery should be correct', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _lastId) done();
                else done('head is not correct.');
            });
        });
        it('tail of gallery should be correct', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _firstId) done();
                else done('tail is not correct.');
            });
        });
        it('gallery should maintain correct linked list after swapping', function (done) {
            var sequence = [
                {_id: _lastId},
                {_id: _firstId}
            ];
            _checkLinkedList(_gname, sequence, done);
        });
        // -- swap them back again
        it('should swap two photos without error (swap back)', function (done) {
            database.getFirstPhotoId(_gname, function (err, firstId) {
                if (err) {
                    done(err);
                    return;
                }
                database.getLastPhotoId(_gname, function (err, lastId) {
                    if (err) {
                        done(err);
                        return;
                    }
                    _firstId = firstId;
                    _lastId = lastId;
                    database.swapTwoPhotos(firstId, lastId, function (err) {
                        if (err) done(err);
                        else done();
                    });
                });
            });
        });
        it('two photos should be swapped correctly (swap back)', function (done) {
            database.getPhotoIdAtIndex(_gname, 0, function (err, id0) {
                if (err) {
                    done(err);
                    return;
                }
                database.getPhotoIdAtIndex(_gname, 1, function (err, id1) {
                    if (err) {
                        done(err);
                        return;
                    }

                    if (id0 == _lastId && id1 == _firstId) {
                        done();
                    } else {
                        done('Result of swapping is not valid:\n\t  actual order: ' +
                            id0 + ', ' + id1 + '\n\t correct order: ' + _lastId + ', ' + _firstId);
                    }
                });
            });
        });
        it('head of gallery should be correct (swap back)', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _lastId) done();
                else done('head is not correct.');
            });
        });
        it('tail of gallery should be correct (swap back)', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _firstId) done();
                else done('tail is not correct.');
            });
        });
        it('gallery should maintain correct linked list after swapping (swap back)', function (done) {
            var sequence = [
                {_id: _lastId},
                {_id: _firstId}
            ];
            _checkLinkedList(_gname, sequence, done);
        });

        // part 2
        var _sequence = null;
        var _photoNumber = 10;
        var _randomIndex = 4; // should be 1 - 8
        it('should empty the non-empty gallery without error', function (done) {
            database.emptyGallery(_gname, function (err) {
                if (err) done(err);
                else done();
            });
        });
        it('should add multiple photos without error', function (done) {
            _addNewPhotos(_gname, _photoNumber, function (err, sequence) {
                if (err) done(err);
                else {
                    _sequence = sequence;
                    done();
                }
            });
        });
        // -- swap same photo
        it('should swap the same photo without error (head)', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                database.swapTwoPhotos(id, id, function (err) {
                    if (err) done(err);
                    else done();
                });
            });
        });
        it('should swap the same photo without error (tail)', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                database.swapTwoPhotos(id, id, function (err) {
                    if (err) done(err);
                    else done();
                });
            });
        });
        it('should swap the same photo without error (random in the middle)', function (done) {
            database.getPhotoIdAtIndex(_gname, _randomIndex, function (err, id) {
                database.swapTwoPhotos(id, id, function (err) {
                    if (err) done(err);
                    else done();
                });
            });
        });
        // -- swap first and last
        it('should swap first and last photo without error (gallery has more than 2 photos)', function (done) {
            database.getFirstPhotoId(_gname, function (err, firstId) {
                if (err) {
                    done(err);
                    return;
                }
                database.getLastPhotoId(_gname, function (err, lastId) {
                    if (err) {
                        done(err);
                        return;
                    }
                    database.swapTwoPhotos(firstId, lastId, function (err) {
                        if (err) done(err);
                        else {
                            done();
                            var temp = _sequence[0];
                            _sequence[0] = _sequence[_sequence.length - 1];
                            _sequence[_sequence.length - 1] = temp;
                        }
                    });
                });
            });


        });
        it('two photos should be swapped correctly', function (done) {
            database.getPhotoIdAtIndex(_gname, 0, function (err, firstId) {
                if (err) {
                    done(err);
                    return;
                }
                database.getPhotoIdAtIndex(_gname, _sequence.length - 1, function (err, lastId) {
                    if (err) {
                        done(err);
                        return;
                    }

                    if (firstId == _sequence[0]._id
                        && lastId == _sequence[_sequence.length - 1]._id) {
                        done();
                    } else {
                        done('Result of swapping is not valid:\n\t  actual order: ' +
                            firstId + ', ' + lastId +
                            '\n\t correct order: ' +
                            _sequence[0]._id + ', ' + _sequence[_sequence.length - 1]._id);
                    }
                });
            });
        });
        it('head of gallery should be correct (part 2, 1)', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _sequence[0]._id) done();
                else done('head is not correct.');
            });
        });
        it('tail of gallery should be correct (part 2, 1)', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _sequence[_sequence.length - 1]._id) done();
                else done('tail is not correct.');
            });
        });
        it('gallery should maintain correct linked list after swapping (part 2, 1)', function (done) {
            _checkLinkedList(_gname, _sequence, done);
        });
        // -- swap randomly
        it('should swap first and a random photo without error (gallery has more than 2 photos)', function (done) {
            database.getFirstPhotoId(_gname, function (err, firstId) {
                if (err) {
                    done(err);
                    return;
                }
                database.getPhotoIdAtIndex(_gname, _randomIndex, function (err, middleId) {
                    if (err) {
                        done(err);
                        return;
                    }
                    database.swapTwoPhotos(firstId, middleId, function (err) {
                        if (err) done(err);
                        else {
                            done();
                            var temp = _sequence[0];
                            _sequence[0] = _sequence[_randomIndex];
                            _sequence[_randomIndex] = temp;
                        }
                    })
                })
            });
        });
        it('should swap last and a random photo without error (gallery has more than 2 photos)', function (done) {
            database.getLastPhotoId(_gname, function (err, lastId) {
                if (err) {
                    done(err);
                    return;
                }
                database.getPhotoIdAtIndex(_gname, _randomIndex, function (err, middleId) {
                    if (err) {
                        done(err);
                        return;
                    }
                    database.swapTwoPhotos(lastId, middleId, function (err) {
                        if (err) done(err);
                        else {
                            done();
                            var temp = _sequence[_sequence.length - 1];
                            _sequence[_sequence.length - 1] = _sequence[_randomIndex];
                            _sequence[_randomIndex] = temp;
                        }
                    })
                })
            });
        });
        it('should swap two random photos without error (gallery has more than 2 photos)', function (done) {
            var rand1 = 6;
            var rand2 = 2;
            database.getPhotoIdAtIndex(_gname, rand1, function (err, id1) {
                database.getPhotoIdAtIndex(_gname, rand2, function (err, id2) {
                    database.swapTwoPhotos(id1, id2, function (err) {
                        if (err) done(err);
                        else {
                            done();
                            var temp = _sequence[rand1];
                            _sequence[rand1] = _sequence[rand2];
                            _sequence[rand2] = temp;
                        }
                    });
                });
            });
        });
        it('head of gallery should be correct (part 2, 2)', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _sequence[0]._id) done();
                else done('head is not correct.');
            });
        });
        it('tail of gallery should be correct (part 2, 2)', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _sequence[_sequence.length - 1]._id) done();
                else done('tail is not correct.');
            });
        });
        it('gallery should maintain correct linked list after swapping (part 2, 2)', function (done) {
            _checkLinkedList(_gname, _sequence, done);
        });

        // remove all, ending the test
        it('should empty the non-empty gallery without error', function (done) {
            database.emptyGallery(_gname, function (err) {
                if (err) done(err);
                else done();
            });
        });
        it('should remove the gallery that is already empty without error', function (done) {
            database.removeGalleryByName(_gname, function (err) {
                if (err) done(err);
                else {
                    done();
                    _gname = null;
                }
            })
        });
    });
}

// test insertPhotoAfterId(), insertPhotoBeforeId(), insertPhotoAtIndex()
function insertPhotoTest() {
    describe('database tests, inserting photos in a gallery\n', function () {
        var _gname = Math.random();
        var _sequence = [];
        it('should create a new gallery without error', function (done) {
            database.createGallery({name: _gname}, function (err) {
                if (err) done(err);
                else done();
            });
        });
        it('should add 3 photos without error', function (done) {
            _addNewPhotos(_gname, 3, function (err, sequence) {
                if (err) done(err);
                else {
                    _sequence = sequence;
                    done();
                }
            });
        });
        // test starts
        it('should insert after the first photo without error', function (done) {
            var photoDoc = {title: '', photoData: _testPhotoData, gallery: _gname};
            database.getFirstPhotoId(_gname, function (err, firstId) {
                database.insertNewPhotoAfterId(photoDoc, firstId, function (err, newDoc) {
                    if (err) done(err);
                    else {
                        var sequence = [];
                        var newElem = {_id: newDoc._id, removed: false};
                        sequence.push(_sequence[0]);
                        sequence.push(newElem);
                        for (var i = 1; i < _sequence.length; i++) {
                            sequence.push(_sequence[i]);
                        }
                        _sequence = sequence;
                        done();
                    }
                });
            });
        });
        it('head of gallery should be correct', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _sequence[0]._id) done();
                else done('head is not correct.');
            });
        });
        it('gallery should maintain correct linked', function (done) {
            _checkLinkedList(_gname, _sequence, done);
        });
        it('should insert before the last photo without error', function (done) {
            var photoDoc = {title: '', photoData: _testPhotoData, gallery: _gname};
            database.getLastPhotoId(_gname, function (err, lastId) {
                database.insertNewPhotoBeforeId(photoDoc, lastId, function (err, newDoc) {
                    if (err) done(err);
                    else {
                        var sequence = [];
                        var newElem = {_id: newDoc._id, removed: false};
                        for (var i = 0; i < _sequence.length - 1; i++) {
                            sequence.push(_sequence[i]);
                        }
                        sequence.push(newElem);
                        sequence.push(_sequence[_sequence.length - 1]);
                        _sequence = sequence;
                        done();
                    }
                });
            });
        });
        it('tail of gallery should be correct', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _sequence[_sequence.length - 1]._id) done();
                else done('tail is not correct.');
            });
        });
        it('gallery should maintain correct linked', function (done) {
            _checkLinkedList(_gname, _sequence, done);
        });

        it('should insert before the first photo without error', function (done) {
            var photoDoc = {title: '', photoData: _testPhotoData, gallery: _gname};
            database.getFirstPhotoId(_gname, function (err, firstId) {
                database.insertNewPhotoBeforeId(photoDoc, firstId, function (err, newDoc) {
                    if (err) done(err);
                    else {
                        var sequence = [];
                        var newElem = {_id: newDoc._id, removed: false};
                        sequence.push(newElem);
                        for (var i = 0; i < _sequence.length; i++) {
                            sequence.push(_sequence[i]);
                        }
                        _sequence = sequence;
                        console.log(_sequence);
                        done();
                    }
                });
            });
        });
        it('head of gallery should be correct', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _sequence[0]._id) done();
                else done('head is not correct.');
            });
        });
        it('tail of gallery should be correct', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                console.log(id);
                if (err) done(err);
                else if (id == _sequence[_sequence.length - 1]._id) done();
                else done('tail is not correct.');
            });
        });
        it('gallery should maintain correct linked', function (done) {
            _checkLinkedList(_gname, _sequence, done);
        });
        
        it('should insert after the last photo without error', function (done) {
            var photoDoc = {title: '', photoData: _testPhotoData, gallery: _gname};
            database.getLastPhotoId(_gname, function (err, lastId) {
                database.insertNewPhotoAfterId(photoDoc, lastId, function (err, newDoc) {
                    if (err) done(err);
                    else {
                        var newElem = {_id: newDoc._id, removed: false};
                        _sequence.push(newElem);
                        console.log('add:',newElem);
                        done();
                    }
                });
            });
        });
        it('head of gallery should be correct', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _sequence[0]._id) done();
                else done('head is not correct.');
            });
        });
        it('tail of gallery should be correct', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _sequence[_sequence.length - 1]._id) done();
                else done('tail is not correct.');
            });
        });
        it('gallery should maintain correct linked', function (done) {
            _checkLinkedList(_gname, _sequence, done);
        });

        // test ends
        it('should empty the gallery without error', function (done) {
            database.emptyGallery(_gname, function (err) {
                if (err) done(err);
                else done();
            });
        });
        it('should remove the gallery without error', function (done) {
            database.removeGalleryByName(_gname, function (err) {
                if (err) done(err);
                else {
                    done();
                    _gname = null;
                }
            })
        });

    });
}

// test reorderPhotos()
function reorderPhotoTest() {
    describe('database tests, reordering photos in a gallery\n', function () {
        var _gname = Math.random();
        var _sequence = [];
        var _photoNumber;

        function swap(i, j) {
            var temp = _sequence[i];
            _sequence[i] = _sequence[j];
            _sequence[j] = temp;
        }

        it('should create a new gallery without error', function (done) {
            database.createGallery({name: _gname}, function (err) {
                if (err) done(err);
                else done();
            });
        });

        // -- multiple photos
        it('should add ' + 10 + ' photos without error', function (done) {
            _photoNumber = 10;
            _addNewPhotos(_gname, _photoNumber, function (err, sequence) {
                if (err) done(err);
                else {
                    _sequence = sequence;
                    done();
                }
            });
        });
        it('should reorder photos without error', function (done) {
            swap(0, 1);
            swap(3, 7);
            swap(4, 0);
            swap(9, 2);
            swap(6, 8);
            swap(7, 2);
            swap(6, 0);
            var s = [];
            for (var i = 0; i < _sequence.length; i++) {
                s.push(_sequence[i]._id);
            }
            database.reorderPhotos(_gname, s, function (err) {
                if (err) done(err);
                else done();
            });
        });
        it('head of gallery should be correct (multiple photos)', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _sequence[0]._id) done();
                else done('head is not correct.');
            });
        });
        it('tail of gallery should be correct (multiple photos)', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _sequence[_sequence.length - 1]._id) done();
                else done('tail is not correct.');
            });
        });
        it('gallery should maintain correct linked (multiple photos)', function (done) {
            _checkLinkedList(_gname, _sequence, done);
        });
        it('should empty the gallery without error', function (done) {
            database.emptyGallery(_gname, function (err) {
                if (err) done(err);
                else done();
            });
        });

        // -- two photos
        it('should add ' + 2 + ' photos without error', function (done) {
            _photoNumber = 2;
            _addNewPhotos(_gname, _photoNumber, function (err, sequence) {
                if (err) done(err);
                else {
                    _sequence = sequence;
                    done();
                }
            });
        });
        it('should reorder photos without error', function (done) {
            swap(0, 1);
            var s = [];
            for (var i = 0; i < _sequence.length; i++) {
                s.push(_sequence[i]._id);
            }
            database.reorderPhotos(_gname, s, function (err) {
                if (err) done(err);
                else done();
            });
        });
        it('head of gallery should be correct (2 photos)', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _sequence[0]._id) done();
                else done('head is not correct.');
            });
        });
        it('tail of gallery should be correct (2 photos)', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _sequence[_sequence.length - 1]._id) done();
                else done('tail is not correct.');
            });
        });
        it('gallery should maintain correct linked (2 photos)', function (done) {
            _checkLinkedList(_gname, _sequence, done);
        });
        it('should empty the gallery without error', function (done) {
            database.emptyGallery(_gname, function (err) {
                if (err) done(err);
                else done();
            });
        });

        // -- one photo
        it('should add ' + 1 + ' photos without error', function (done) {
            _photoNumber = 1;
            _addNewPhotos(_gname, _photoNumber, function (err, sequence) {
                if (err) done(err);
                else {
                    _sequence = sequence;
                    done();
                }
            });
        });
        it('should reorder photos without error', function (done) {
            var s = [];
            for (var i = 0; i < _sequence.length; i++) {
                s.push(_sequence[i]._id);
            }
            database.reorderPhotos(_gname, s, function (err) {
                if (err) done(err);
                else done();
            });
        });
        it('head of gallery should be correct (1 photo)', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _sequence[0]._id) done();
                else done('head is not correct.');
            });
        });
        it('tail of gallery should be correct (1 photo)', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == _sequence[_sequence.length - 1]._id) done();
                else done('tail is not correct.');
            });
        });
        it('gallery should maintain correct linked (1 photo)', function (done) {
            _checkLinkedList(_gname, _sequence, done);
        });
        it('should empty the gallery without error', function (done) {
            database.emptyGallery(_gname, function (err) {
                if (err) done(err);
                else done();
            });
        });

        // -- zero photo
        it('should reorder photos without error', function (done) {
            _photoNumber = 0;
            _sequence = [];
            var s = [];
            for (var i = 0; i < _sequence.length; i++) {
                s.push(_sequence[i]._id);
            }
            database.reorderPhotos(_gname, s, function (err) {
                if (err) done(err);
                else done();
            });
        });
        it('head of gallery should be null (0 photo)', function (done) {
            database.getFirstPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == null) done();
                else done('head is not correct.');
            });
        });
        it('tail of gallery should be null (0 photo)', function (done) {
            database.getLastPhotoId(_gname, function (err, id) {
                if (err) done(err);
                else if (id == null) done();
                else done('tail is not correct.');
            });
        });

        // test ends
        it('should remove the gallery without error', function (done) {
            database.removeGalleryByName(_gname, function (err) {
                if (err) done(err);
                else {
                    done();
                    _gname = null;
                }
            })
        });
    })
}

basicTest();
// advancedTest();
// movePhotoTest();
// swapPhotoTest();
// insertPhotoTest();
// reorderPhotoTest();

function _addNewPhotos(gname, number, done) {
    helper(gname, number, 0, [], done);
    function helper(gname, total, counter, sequence, done) {
        if (counter < total) {
            database.addNewPhoto({title: counter, photoData: _testPhotoData, gallery: gname}, function (err, newDoc) {
                if (err) {
                    done(err);
                } else {
                    sequence.push({_id: newDoc._id, removed: false});
                    helper(gname, total, counter + 1, sequence, done);
                }
            })
        } else {
            done(null, sequence);
        }
    }
}
function _checkLinkedList(gname, correctSequence, done) {
    // ensure doubly linked list integrity
    database.getFirstPhotoId(gname, function (err, head) {
        if (err) {
            done(err);
            return;
        }
        checkIntegrity(head);
    });

    function checkIntegrity(pid) {
        database.getNextPhotoId(pid, function (err, nextId) {
            if (err) {
                done(err);
                return;
            }
            if (nextId) {
                database.getPrevPhotoId(nextId, function (err, prevId) {
                    if (err) {
                        done(err);
                        return;
                    }
                    if (prevId != pid) {
                        done('Doubly linked list integrity check failed:\n\t' + pid + '\n\t' + prevId);
                        return;
                    }
                    checkIntegrity(nextId);
                });
            } else {

                database.getLastPhotoId(gname, function (err, lastId) {
                    if (lastId == pid) { // passed
                        checkCorrectSequence();
                    } else { // not passed
                        done('Doubly linked list integrity check failed: Gallery tail does not match last photo id.');
                    }
                });
            }
        })
    }

    function checkCorrectSequence() {
        // compare to correct sequence record
        database.getAllPhotosSorted(gname, function (err, docs) {
            if (err) {
                done(err);
                return;
            }
            var offset = 0;
            for (var i = 0; i < docs.length; i++) {
                while (true) {
                    if (correctSequence[i + offset].removed) {
                        offset++;
                    } else {
                        break;
                    }
                }
                if (!docs[i]._id.equals(correctSequence[i + offset]._id)) {
                    done('Linked list is violated at actual[' + i + ']: ' + docs[i]._id
                        + ' and record[' + (i + offset) + ']: ' + correctSequence[i + offset]._id);
                    return;
                }
            }
            done();
        });
    }

}
